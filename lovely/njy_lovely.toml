[manifest]
version = "1.0.0"
dump_lua = true
priority = 0

# prevent chip total from triggering end of round
[[patches]]
[patches.pattern]
target = "game.lua"
pattern = "if G.GAME.chips - G.GAME.blind.chips >= 0 or G.GAME.current_round.hands_left < 1 then"
position = "at"
payload = '''
if G.GAME.current_round.hands_left < 1 then
'''
match_indent = true

# dumb code to swap colour, updates every frame (lmfao)
[[patches]]
[patches.pattern]
target = "game.lua"
pattern = "self.C.DARK_EDITION[2] = math.min(self.C.DARK_EDITION[3], self.C.DARK_EDITION[1])"
position = "after"
payload = '''
	if self.GAME and self.GAME.chips and self.GAME.blind and self.GAME.blind.chips then
		if self.GAME.chips - self.GAME.blind.chips >= 0 then
			self.C.CHIPS_REQUIRED[1] = 0.2941
			self.C.CHIPS_REQUIRED[2] = 0.76
			self.C.CHIPS_REQUIRED[3] = 0.5725
		else
			self.C.CHIPS_REQUIRED[1] = 1
			self.C.CHIPS_REQUIRED[2] = 0.3725
			self.C.CHIPS_REQUIRED[3] = 0.3333
		end
	else
		self.C.CHIPS_REQUIRED[1] = 1
		self.C.CHIPS_REQUIRED[2] = 0.3725
		self.C.CHIPS_REQUIRED[3] = 0.3333
	end
'''
match_indent = true

# change colour of chips required in UI_def (makes chip total green if requirement is met)
[[patches]]
[patches.pattern]
target = "functions/UI_definitions.lua"
pattern = "{n=G.UIT.T, config={ref_table = G.GAME.blind, ref_value = 'chip_text', scale = 0.001, colour = G.C.RED, shadow = true, id = 'HUD_blind_count', func = 'blind_chip_UI_scale'}}"
position = "at"
payload = '''
{n=G.UIT.T, config={ref_table = G.GAME.blind, ref_value = 'chip_text', scale = 0.001, colour = G.C.CHIPS_REQUIRED, shadow = true, id = 'HUD_blind_count', func = 'blind_chip_UI_scale'}}
'''
match_indent = true

# change colour of chips in cashout screen for parity
[[patches]]
[patches.pattern]
target = "functions/common_events.lua"
pattern = "{n=G.UIT.T, config={text = G.GAME.blind.chip_text, scale = scale_number(G.GAME.blind.chips, scale, 100000), colour = G.C.RED, shadow = true}}"
position = "at"
payload = '''
{n=G.UIT.T, config={text = G.GAME.blind.chip_text, scale = scale_number(G.GAME.blind.chips, scale, 100000), colour = G.C.GREEN, shadow = true}}
'''
match_indent = true

# insert new colour into globals.lua
[[patches]]
[patches.pattern]
target = "globals.lua"
pattern = "RED = HEX('FE5F55'),"
position = "before"
payload = '''
CHIPS_REQUIRED = {0,0,0,1},
'''
match_indent = true

# add ugly end round button
[[patches]]
[patches.pattern]
target = "functions/UI_definitions.lua"
pattern = '''G.SETTINGS.play_button_pos == 1 and play_button or discard_button,'''
position = "after"
payload = '''
{n=G.UIT.R, config={id = 'njy_endround_button',align = "tm", padding = 0.3, r = 0.1, minw = 2.5, minh = button_height, hover = true, colour = G.C.GREEN, button = "njy_endround", one_press = true, shadow = true, func = 'njy_can_endround'}, nodes={
      {n=G.UIT.R, config={align = "cm", padding = 0}, nodes={
        {n=G.UIT.T, config={text = "End Round", scale = text_scale, colour = G.C.UI.TEXT_LIGHT, focus_args = {button = 'y', orientation = 'bm'}, func = 'set_button_pip'}}
      }}
    }}
'''
match_indent = true

